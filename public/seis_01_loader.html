<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDS : Seismic Data Loader</title>
    <link rel="stylesheet" type="text/css" href="./lib/w2ui/w2ui-2.0.min.css">
    <link href="lib/bootstrap.min.css" rel="stylesheet">
    <link href="lib/bootstrap-icons.css" rel="stylesheet">
    <!--<link href="stylesheets/style.css" rel="stylesheet">-->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        .progress {
            margin-top: 0px;
            margin-bottom: 5px;
        }
        

        .progress-bar-warning {
            background-color: #f78c68;
        }
        .progress-bar-secondary {
            background-color: #a7aeb7;
        }
        .progress-bar-dark {
            background-color: #66686a;
        }
        .control-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .right-buttons {
            display: flex;
            gap: 10px;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;  
            margin-top: 5px;          
            margin-bottom: 5px;
        }
        
        .status-bar .status-message {
            font-size: 0.8rem;
            font-style: italic;
        }

        .status-bar .bytes-transferred{
            font-size: 0.8rem;
            
        }

        .file-selection-bar {
            display: flex;
            justify-content: space-between;  
            margin-top: 5px;          
            margin-bottom: 5px;
        }


        .file-selection-bar .add-file-button {
            flex: 0.1;           
        }

        
        .file-selection-bar .file-selection-result{
            flex: 0.9;   
        }
        /*.file-selection-bar .show-queue-button{
            flex: 0.1;   
        }*/
        /*.file-selection-bar .queue-badge{
            flex: 0.03;   
        }*/

        .delete-icon {
            cursor: pointer;
            color: #dc3545; /* Bootstrap's "danger" color */
            font-size: 1.2rem;
        }
        .delete-icon:hover {
            transform: scale(1.2);
            color: #bd2130; /* Slightly darker shade for hover */
            transition: transform 0.2s ease, color 0.2s ease;
        }

        .resume-icon {
            cursor: pointer;
            color: #7191ce; /* Bootstrap's "danger" color */
            font-size: 1.2rem;
        }
        .resume-icon:hover {
            transform: scale(1.2);
            color: #0327948f; /* Slightly darker shade for hover */
            transition: transform 0.2s ease, color 0.2s ease;
        }
        .navbar {
            padding-top: 0.2rem; /* Reduce top padding */
            padding-bottom: 0.2rem; /* Reduce bottom padding */
        }
        
        .navbar-brand img {
            height: 48px; /* Adjust logo height */
        }
        .drop-area {
            font-size: 0.9rem;
            border: 2px dashed #3b3e42;
            padding: 5px;
            text-align: center;
            margin-bottom: 5px;
            cursor: pointer;
            height: 100px;
            overflow: auto;
            
        }

        .current-file-label{
            padding: 5px;
            font-style: bold;
        }

        .text-medium{
            font-size: 0.9rem;
        }
        .text-small{
            font-size: 0.8rem;
        }
    </style>

</head>
<body>
    
        
    <div class="container">
        <!--<div class="row gx-5 text-center">
            <div class="col">
                <h3  class="text-center">
                    <img src="images/cloud-arrow-up.svg" alt="Bootstrap" width="32" height="32">&nbsp;<b>File Upload</b>
                    <br><small class="text-body-secondary"> Upload SEG-Y files from your computer to EDS File Staging Area</small>
                </h3>
            </div>
        </div>-->
        <nav class="navbar bg-body-secondary">
            <div class="container-fluid">     
                <a class="navbar-brand">EDS Seismic Uploader</a>
                <form class="d-flex " role="search">
                    <div class="input-group">
                        <span  class="input-group-text" style="font-size: 0.8rem;">Welcome</span>
                        <input type="text" id="cpfNo" class="form-control" style="font-size: 0.8rem;" aria-label="CPF" aria-describedby="cpfNo" value="125363">
                    </div>  
                </form>
            </div>
        </nav>
        <div class="row gx-5 text-left mt-1">
            <div class="col">
                <!--<div class="control-buttons mb-1">
                    <button id="startUpload" class="btn btn-sm btn-secondary"> <i class="bi bi-play-fill"></i> Start Upload</button>
                    <div class="right-buttons">
                        <button id="pauseUpload" class="btn btn-secondary"><i class="bi bi-pause-fill"></i> Pause</button>
                        <button id="resumeUpload" class="btn btn-secondary"><i class="bi bi-arrow-repeat"></i> Resume</button>
                        <button id="stopUpload" class="btn btn-secondary"><i class="bi bi-stop-fill"></i> Stop</button>
                    </div>
                </div>-->
                <div style="font-family:'OpenSans';color:#222021cc;border: 1px solid #efefef;border-bottom:0; padding: 5px">
                    <b><i class="bi bi-file-earmark-arrow-up"></i> File Upload </b>
                </div>
                <div style="border: 1px solid #efefef;border-top:0; padding-left: 5px;padding-right: 5px">
                    <div class="file-selection-bar">                       
                        <button class="btn btn-secondary add-file-button" id="chooseFile" type="button" style="font-size: 0.8rem;"><i class="bi bi-file-earmark-plus"></i> Add Files...</button>
                       
                        <span class="file-selection-result" style="font-size: 0.8rem;border: 1px solid #efefef;padding: 5px">
                            <span id="fileSelectionResult" class="text-secondary"></span>
                        </span>                          
                        <!--<input type="text" class="form-control" placeholder="No file selected."  style="font-size: 0.8rem;" readonly id="selectedFileName" aria-label="" aria-describedby="basic-addon1">-->
                        <!--<button class="btn btn-secondary show-queue-button" style="font-size: 0.8rem;" type="button" id="showQueue">
                            <i class="bi bi-list-ul"></i> Upload Queue
                        </button>-->
                        <!--<span class="input-group-text text-small queue-badge" id="queueBadge">0</span>-->
                       
                    </div>
                    <!--<div id="fileError" class="text-danger mt-2 mb-2" style="font-size: 0.8rem;"></div>-->
                    <div id="currentuploadtoolbar" style="width: 100%;margin-bottom: 5px; "></div>
                    
                    <div class="progress mb-1">
                        <div id="uploadProgress" class="progress-bar progress-bar-animated progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
                            0%
                        </div>
                    </div>
                    <div class="status-bar">
                        
                        <span id="statusMessage" class="status-message"></span>
                        <span id="bytesTransferred" class="bytes-transferred"></span>
                    </div>
                    
                </div>
                
                <!--<div class="progress">
                    <div id="uploadProgress" class="progress-bar progress-bar-animated progress-bar-striped bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
                        0%
                    </div>
                </div>-->
            
                <!-- Status message and bytes transferred -->
                <!--<div class="status-bar">
                    <span id="statusMessage" class="status-message"></span>
                    <span id="bytesTransferred"></span>
                </div>-->
            </div>    
        </div>
        <div class="row mt-2">
            <div class="col-12">
                <div id="queuegrid" style="width: 100%; height: 275px;"></div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-5">
                <div id="grid" style="width: 100%; height: 450px;"></div>
            </div>
            <div class="col-7">
                <div id="pendinguploadsgrid" style="width: 100%; height: 450px;"></div>

                <!--<h3>Pending Uploads</h3>
                <h6>In order to complete a pending upload, choose the file again from your computer using the "Browse" Button above and click "Start Upload". This will upload only the remaining part of the file.</h5>
                <table class="table align-middle">
                    <thead>
                    <tr>
                        <th scope="col" style="width: 30%;">File Name</th>
                        <th scope="col" style="width: 10%;">Size</th>               
                        <th scope="col" style="width: 20%;">Started At</th>   
                        <th scope="col" style="width: 15%;">Uploaded By</th>                     
                        <th scope="col" style="width: 15%;">Progress</th>
                        <th scope="col" style="width: 10%;"></th>                        
                    </tr>
                    </thead>
                    <tbody id="uploaded-files-list">-->
                    <!-- Uploaded files will be listed here --><!--
                </table>-->
            </div>
        </div>
        

        <!-- File Selection Modal -->
        <div class="modal fade" style="display: none;" id="fileSelectionModal"  tabindex="-1" aria-labelledby="fileSelectionLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-secondary">
                    <span class="modal-title" id="fileSelectionLabel">Choose files from your Computer</span>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <div class="drop-area" id="fileDrop" style="margin-left: 0;" ondragover="event.preventDefault()">Drag and drop files here</div>
                                <!--<div class="drop-area" id="fileDrop" ondrop="handleDrop(event)" ondragover="event.preventDefault()">Drag and drop file here</div>-->
                                
                                <span style="font-size: 0.9rem">Or
                                    <br>Use the File explorer below</span>
                                
                                <input class="form-control" style="font-size: 0.9rem" type="file" id="fileInput" multiple >
                            </div>
                        
                        </div>                     
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" style="font-size: 0.9rem" id="selectFile" disabled>Select</button>
                        <button type="button" class="btn btn-secondary"  style="font-size: 0.9rem" data-bs-dismiss="modal">Cancel</button>                        
                    </div>
                </div>
            </div>
        </div>

        <!-- File Resumption Modal -->
        <div class="modal fade" style="display: none;" id="fileResumptionModal"  tabindex="-1" aria-labelledby="fileResumptionLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-secondary">
                    <span class="modal-title" id="fileResumptionLabel">Choose the file from your Computer</span>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning" style="word-wrap: break-word;" role="alert">
                            <i class="bi bi-info-circle"></i> Important Information about Resuming Uploads<br>
                            To resume a previously paused/interrupted upload, please reselect the same file. Even though our system remembers your upload progress, browsers do not allow automatic file selection for your privacy and security. This ensures that websites cannot access your files without your permission.
                        </div>
                        <span>Please choose the file <strong id="resumptionFileLabel"></strong> again from your computer.</span>
                        <div class="text-center">
                            <div class="drop-area" id="fileResumptionDrop" style="margin-left: 0;" ondragover="event.preventDefault()">Drag and drop the file here</div>
                            <!--<div class="drop-area" id="fileDrop" ondrop="handleDrop(event)" ondragover="event.preventDefault()">Drag and drop file here</div>-->
                            
                            <span style="font-size: 0.9rem">Or
                                <br>Use the File explorer below</span>
                            
                            <input class="form-control" style="font-size: 0.9rem" type="file" id="fileResumptionInput">
                            </div>
                            <div id="resumptionFileError" class="text-danger mt-2 mb-2" style="font-size: 0.8rem;display:none"></div>
                        </div> 
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" style="font-size: 0.9rem" id="selectResumptionFile" disabled>Add to Queue</button>
                        <button type="button" class="btn btn-secondary"  style="font-size: 0.9rem" data-bs-dismiss="modal">Cancel</button>                        
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap Modal for File Status Check -->
        <div class="modal fade" id="fileStatusModal" tabindex="-1" aria-labelledby="fileStatusModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header bg-secondary" style="padding: 10px;">
                        <h5 class="modal-title text-medium" id="fileStatusModalLabel"><b><i class="bi bi-list-check"></i> File Selection Result</b></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!--<div class="modal-body" style="max-height: 400px; overflow-y: auto;">-->
                    <div class="modal-body" style="padding: 0px;">
                        <div id="filestatusgrid" style="width: 100%;height:210px;"></div>
                        <!--<table class="table table-bordered text-small">
                            <thead>
                                <tr>
                                    <th style="width: 40%;">File Name</th>
                                    <th style="width: 20%;">Status</th>
                                    <th style="width: 40%;">Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="fileStatusTableBody">
                                 
                            </tbody>
                        </table>-->
                    </div>
                    <div class="modal-footer" style="padding: 0px;">
                        <button type="button" class="btn btn-sm btn-secondary text-small  mr-auto" data-bs-dismiss="modal">Ok</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Upload Queue Modal -->
        <!--<div class="modal fade" id="queueModal" tabindex="-1" aria-labelledby="queueModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header  bg-secondary">
                        <h5 class="modal-title  text-medium" id="queueModalLabel">Upload Queue</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-2">
                            <button class="btn btn-primary btn-sm" onclick="moveUp()">Move Up</button>
                            <button class="btn btn-primary btn-sm" onclick="moveDown()">Move Down</button>
                            <button class="btn btn-danger btn-sm" onclick="removeFile()">Remove</button>
                        </div>
                        <div style="max-height: 400px;overflow-y: auto;">
                            <table class="table table-bordered text-small">
                                <thead>
                                    <tr>                                       
                                        <th style="width:40%">File Name</th>
                                        <th style="width:10%">Size</th>
                                        <th style="width:15%">Queue Status</th>
                                        <th style="width:35%">Upload Progress</th>                                    
                                    </tr>
                                </thead>
                                <tbody id="queueListTableBody">
                                   
                                </tbody>
                            </table>   
                        </div>                                             
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"  style="font-size: 0.9rem" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
     -->

        <!-- Rename Input Modal -->
        <div class="modal fade" id="renameModal" tabindex="-1" aria-labelledby="renameModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-secondary">
                        <h5 class="modal-title  text-medium" id="renameModalLabel">Rename File</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <label for="newFileNameInput" class="form-label text-small">New File Name:</label>
                        <input type="text" id="newFileNameInput" class="form-control text-medium" />
                        <div id="renameError" class="text-danger mt-2 text-small" style="min-height: 1.2rem;"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary text-small" id="renameFile">Rename</button>
                        <button type="button" class="btn btn-secondary text-small" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" style="display: none;" id="deleteConfirmationModal"  tabindex="-1" aria-labelledby="deleteConfirmationLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-secondary">
                        <span class="modal-title text-medium" id="deleteConfirmationLabel">Confirm deletion</span>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <span class="text-small" id="deleteConfirmationText">Are you sure you want to delete the file?</span>
                    
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary text-small" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger text-small" id="confirmDeleteButton" file-grid-name="">Delete</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Skip Confirmation Modal -->
        <div class="modal fade" style="display: none;" id="skipConfirmationModal"  tabindex="-1" aria-labelledby="skipConfirmationModal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-secondary">
                        <span class="modal-title text-medium" id="skipConfirmationLabel">Confirm Skip Upload</span>
                        <button id="skipModalCancelX" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <span class="text-medium">Are you sure you want to skip this upload? This will stop the upload of current file while retaining the partial upload on the server for resumption in future.</span>
                    </div>
                    <div class="modal-footer">                        
                        <button type="button" class="btn btn-danger text-small" id="confirmSkipButton" >Skip</button>
                        <button type="button" class="btn btn-secondary text-small" id="skipModalCancel" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Stop Confirmation Modal -->
        <div class="modal fade" style="display: none;" id="stopConfirmationModal"  tabindex="-1" aria-labelledby="stopConfirmationLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header  bg-secondary">
                        <span class="modal-title text-medium" id="stopConfirmationLabel">Confirm Stop Upload</span>
                        <button id="stopModalCancelX" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <span class="text-medium">Are you sure you want to stop this upload? This will skip all the remaining files in the queue while retaining the partial uploads on the server for resumption in future.</span>
                    </div>
                    <div class="modal-footer">                        
                        <button type="button" class="btn btn-danger text-small" id="confirmStopButton" >Stop </button>
                        <button type="button" class="btn btn-secondary text-small" id="stopModalCancel" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Deletion results modal -->
        <div class="modal fade" id="deletionResultsModal" tabindex="-1" aria-labelledby="deletionResultsLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered ">
                <div class="modal-content">
                    <div class="modal-header bg-secondary"  style="padding: 10px;">
                        <span class="modal-title text-medium" id="deletionResultsLabel">File Deletion Results</span>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>                
                    <!--<div class="modal-body" style="max-height: 70vh; overflow-y: auto;">-->
                    <div class="modal-body" style="padding: 0px;">
                        <div id="deletionresultsgrid" style="width: 100%;height:210px;"></div>
                        <!--<table class="table table-bordered  text-small">
                        <thead>
                            <tr>
                            <th></th>
                            <th>File Name</th>
                            <th>Status</th>
                            <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="deletionResultsBody"></tbody>
                        </table>-->
                    </div> 
                    <div class="modal-footer" style="padding: 0px;">
                        <button type="button" class="btn btn-sm btn-secondary text-small mr-auto" data-bs-dismiss="modal">Ok</button>
                    </div>  
                </div>             
            </div>            
        </div>

        <!-- Rename Result Modal -->
        <div class="modal fade" id="renameResultModal" tabindex="-1" aria-labelledby="renameResultModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-secondary">
                        <span class="modal-title text-medium" id="renameResultModalLabel">Rename Result</span>
                    
                    </div>
                    <div class="modal-body text-small" id="renameResultBody"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary text-small" data-bs-dismiss="modal">Ok</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Operation not allowed modal -->
        <div class="modal fade" style="display: none;" id="opNotAllowedModal"  tabindex="-1" aria-labelledby="opNotAllowedLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-secondary">
                        <span class="modal-title" id="opNotAllowedLabel">Operation not permitted</span>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center text-small">
                        <div class="alert alert-danger" role="alert">
                            <i class="bi bi-x-circle"></i><br>
                            <label id="opNotAllowedText">Operation not permitted</label>
                        </div>                          
                    </div>
                    <div class="modal-footer">                        
                         <button type="button" class="btn btn-secondary text-small" data-bs-dismiss="modal">Ok</button>                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="lib/tus.js"></script>     
    <script src="lib_1/jquery-3.2.1.min.js"></script>
    <script src="lib/bootstrap.bundle.min.js"></script>
    
    <script src="./lib/w2ui/w2ui-2.0.min.js"></script>
    <script>
        let queuegrid = new w2grid({
            name: 'queuegrid',
            box: '#queuegrid',
            header: '<b><i class="bi bi-list-ul"></i> Upload Queue (<span class="text-small" id="queueBadge">0</span>)</b>',            
            show: {
                header: true,
                //footer: true,
                toolbar: true,
               selectColumn: true,
               recordTitles: true,
               toolbarSearch: false, 
               toolbarReload:false,
               lineNumbers: true
                //lineNumbers: true
            },
            
            //url: 'data/list.json',
            //method: 'GET', // need this to avoid 412 error on Safari
            columns: [
                { field: 'filename', text: 'File Name', size: '40%' },
                { field: 'size', text: 'Size', size: '10%',tooltip:'Size' },
                { field: 'status', text: 'Status', size: '15%',tooltip:'Status' },
                { field: 'progress', text: 'Progress', size: '35%',tooltip:'Progress' }
            ],
            async onSelect(event) {
               
                await event.complete   
                //event.preventDefault();
                let selection = this.getSelection();
                
                if(selection.length==1){
                    recId=selection[0];
                    let queueStatus = w2ui.queuegrid.get(recId).queuestatus; 
                    if(queueStatus===0){                        
                        //The followin code takes advantage of the fact that recids in queuegrid are indices of the queue
                        if(recId===0){// means this is the first item
                            this.toolbar.disable('moveUp');
                            this.toolbar.enable('moveDown','removeFromQueue'); 
                        }                        
                        else if(recId===(w2ui.queuegrid.records.length-1)){// means this is the last item
                            this.toolbar.disable('moveDown');
                            let aboveStatus=w2ui.queuegrid.get(recId-1).queuestatus; 
                            if(aboveStatus>0){ // Means they are in progress or done processing i.e.Uploading, Completed, failed, or Skipped
                                this.toolbar.disable('moveUp');
                                this.toolbar.enable('removeFromQueue'); 
                            }
                            else{
                                this.toolbar.enable('moveUp','removeFromQueue');
                            }
                            
                        }                        
                        else { // means this item is in somewhere middle
                            let aboveStatus=w2ui.queuegrid.get(recId-1).queuestatus; 
                            if(aboveStatus>0){ // Means they are in progress or done processing i.e.Uploading, Completed, failed, or Skipped
                                this.toolbar.disable('moveUp');
                                this.toolbar.enable('moveDown','removeFromQueue'); 
                            }
                            else{
                                this.toolbar.enable('moveUp','moveDown','removeFromQueue');
                            }                            
                        }
                    }
                    else{
                        this.toolbar.disable('moveUp','moveDown','removeFromQueue');
                    }                                        
                }
                else if(selection.length>1){
                    this.toolbar.disable('moveUp','moveDown');
                    let queueStatuses=selection.map(entry => w2ui.queuegrid.get(entry).queuestatus); // w2ui record property which is not visible
                    
                    if(queueStatuses.includes(1)||queueStatuses.includes(2)||queueStatuses.includes(3)||queueStatuses.includes(4)){
                        this.toolbar.disable('removeFromQueue');
                    }
                    else{
                        this.toolbar.enable('removeFromQueue');
                    }
                    
                }
                else{
                    this.toolbar.disable('moveUp','moveDown','removeFromQueue');
                }


                /*let recid=event.detail.clicked.recid;
                if(recid){
                    if(this.get(recid).queuestatus===0)
                        console.log("Write Code to Select");
                    else
                        console.log("Write Code to not Select");
                }*/
            },            
            toolbar: {
                items: [                    
                    { type: 'button', id: 'moveUp', text: 'Move Up', icon: 'bi bi-caret-up',disabled:true, tooltip:"Move Up" },
                    { type: 'break' },                   
                    { type: 'button', id: 'moveDown', text: 'Move Down', icon: 'bi bi-caret-down',disabled:true, tooltip:"Move Down" },
                    { type: 'break' },
                    { type: 'button', id: 'removeFromQueue', text: 'Remove', icon: 'bi bi-x',disabled:true, tooltip:"Remove" },
                ],
                async onClick(event) {                    
                    selectedFiles=w2ui.queuegrid.getSelection();
                    switch (event.target) {
                        case "moveUp":                        
                            moveUpInQueue(selectedFiles);
                            break;
                        case "moveDown": 
                            moveDownInQueue(selectedFiles);
                            break;
                        case "removeFromQueue": 
                            removeFromQueue(selectedFiles);
                            break;                                                                          
                        default:
                            break;
                    }
                }
            }            
        });
        let filestatusgrid = new w2grid({
            name: 'filestatusgrid',
            box: '#filestatusgrid',
            //header: '<b><i class="bi bi-list-task"></i> File Selection Result</b>',            
            show: {
                header:false,
                footer: true,               
                recordTitles: true,
                lineNumbers: true
            },
            columns: [
                { field: 'filename', text: 'File Name', size: '35%' },
                { field: 'status', text: 'Status', size: '15%',tooltip:'Status' },
                { field: 'remarks', text: 'Remarks', size: '50%',tooltip:'Remarks' }
            ],            
        });

        let deletionresultsgrid = new w2grid({
            name: 'deletionresultsgrid',
            box: '#deletionresultsgrid',
            //header: '<b><i class="bi bi-list-task"></i> File Deletion Result</b>',            
            show: {
                header:false,
                footer: true,               
                recordTitles: true,
                lineNumbers: true
            },
            columns: [
                { field: 'filename', text: 'File Name', size: '35%' },
                { field: 'status', text: 'Status', size: '15%',tooltip:'Status' },
                { field: 'remarks', text: 'Remarks', size: '50%',tooltip:'Remarks' }
            ],            
        });

        let grid = new w2grid({
            name: 'grid',
            box: '#grid',
            header: '<b><i class="bi bi-files"></i> Files uploaded in Staging Area</b>',            
            show: {
                header: true,
                //footer: true,
                toolbar: true,
               selectColumn: true,
               recordTitles: true
                
                //lineNumbers: true
            },
            searches: [
                { type: 'text',  field: 'filename', label: 'File Name' },
                { type: 'int', field: 'size', label: 'Size' },
                { type: 'text', field: 'uploaded_by', label: 'Uploaded By' },
                { type: 'date', field: 'uploaded_at', label: 'Uploaded At' }
            ],
            //url: 'data/list.json',
            //method: 'GET', // need this to avoid 412 error on Safari
            columns: [
                { field: 'filename', text: 'File Name', size: '40%' },
                { field: 'size', text: 'Size', size: '15%',tooltip:'Size' },
                { field: 'uploaded_by', text: 'Uploaded By', size: '15%',tooltip:'Uploaded By' },
                { field: 'uploaded_at', text: 'Uploaded At', size: '30%',tooltip:'Uploaded At' }
            ],
            async onSelect(event) {
                await event.complete
                
                if(this.getSelection().length>1){
                    this.toolbar.disable('renameFile');
                    this.toolbar.enable('deleteFile');
                }
                else if(this.getSelection().length==1)
                    this.toolbar.enable('renameFile','deleteFile');
                else
                    this.toolbar.disable('renameFile','deleteFile');
            },
            toolbar: {
                items: [
                    { type: 'spacer' },
                    { type: 'button', id: 'renameFile', text: '', icon: 'bi bi-pencil-square',disabled:true, tooltip:"Rename" },
                    { type: 'break' },
                    { type: 'button', id: 'deleteFile', text: '', icon: 'bi bi-trash',disabled:true, tooltip:"Delete" },  
                    
                ],
                async onClick(event) {
                    //console.log('Target: '+ event.target, event);
                    //console.log(event.target);
                    //document.querySelectorAll(".tab-content").forEach(x=>x.setAttribute("style","display:none"));
                    //document.querySelector(`#${event.target}`).setAttribute("style","");
                    //let content;
                    selectedFiles=w2ui.grid.getSelection();
                    switch (event.target) {
                        case "renameFile":                        
                            renameFile(selectedFiles);
                            break;
                        case "deleteFile": 
                            deleteFiles(selectedFiles,w2ui.grid);
                            break;
                        case "w2ui-reload": 
                            listCompletedFiles();
                            break;                                                                          
                        default:
                            break;
                    }
                }
            }
            
        });
        let pendinguploadsgrid = new w2grid({
            name: 'pendinguploadsgrid',
            box: '#pendinguploadsgrid',
            header: '<b><i class="bi bi-file-earmark-break"></i> Pending uploads</b>',
            show: {
                header: true,
                //footer: true,
                toolbar: true,
                selectColumn: true,
                recordTitles: true
                //lineNumbers: true
            },
            searches: [
                { type: 'text',  field: 'filename', label: 'File Name' },
                { type: 'int', field: 'size', label: 'Size' },
                { type: 'text', field: 'uploaded_by', label: 'Uploaded By' },
                { type: 'date', field: 'uploaded_at', label: 'Started At' }                
            ],
            //url: 'data/list.json',
            //method: 'GET', // need this to avoid 412 error on Safari
            columns: [
                { field: 'filename', text: 'File Name', size: '30%' },
                { field: 'progress', text: 'Progress', size: '30%' },
                { field: 'size', text: 'Size', size: '10%',tooltip:'Size' },                
                { field: 'uploaded_by', text: 'Uploaded By', size: '10%',tooltip:'Uploaded By' },
                { field: 'uploaded_at', text: 'Last Updated At', size: '20%',tooltip:'Started At' },
                
            ],
            async onSelect(event) {
                await event.complete
                //console.log('select', event.detail, this.getSelection())
                if(this.getSelection().length>1){
                    this.toolbar.enable('deletePendingUpload');
                    this.toolbar.disable('resumeUploadFromList');
                }
                else if(this.getSelection().length==1)
                    this.toolbar.enable('resumeUploadFromList','deletePendingUpload');
                else
                    this.toolbar.disable('resumeUploadFromList','deletePendingUpload');
            },
            toolbar: {
                items: [
                    { type: 'spacer' },
                    { type: 'button', id: 'resumeUploadFromList', text: '', icon: 'bi bi-play-circle',disabled:true,tooltip:"Resume"},
                    { type: 'break' },
                    { type: 'button', id: 'deletePendingUpload', text: '', icon: 'bi bi-trash',disabled:true, tooltip:"Delete"},  
                    
                ],
                async onClick(event) {
                    //console.log('Target: '+ event.target, event);
                    //console.log(event.target);
                    //document.querySelectorAll(".tab-content").forEach(x=>x.setAttribute("style","display:none"));
                    //document.querySelector(`#${event.target}`).setAttribute("style","");
                    //let content;
                    selectedFiles=w2ui.pendinguploadsgrid.getSelection();
                    switch (event.target) {
                        case "resumeUploadFromList":                        
                            resumeFromList(selectedFiles);
                            break;
                        case "deletePendingUpload": 
                            deleteFiles(selectedFiles,w2ui.pendinguploadsgrid);
                            break;  
                        case "w2ui-reload": 
                            listFiles();       
                            break;                                         
                        default:
                            break;
                    }
                }
            },
        });
        
        
        let currentuploadtoolbar = new w2toolbar({
            box: '#currentuploadtoolbar',
            name: 'currentuploadtoolbar',
            items: [
                { type: 'button', id: 'startUpload', text: 'Start Upload', icon: 'bi bi-play-fill',disabled:true },  
                    { type: 'break' },              
                
                {type: 'html',  id: 'currentFilelabel',value:"",
                    html(item) {
                        let html =
                            `<div class="current-file-label">${item.value}</span>`
                        return html
                    }
                },
                { type: 'spacer' },
                { type: 'break' },    
                { type: 'button', id: 'pauseUpload', text: 'Pause', icon: 'bi bi-pause-fill' },
                { type: 'break' },
                { type: 'button', id: 'resumeUpload', text: 'Resume', icon: 'bi bi-play-circle' },
                { type: 'break' },
                { type: 'button', id: 'skipUpload', text: 'Skip', icon: 'bi bi-skip-forward' },
                { type: 'break' },
                { type: 'button', id: 'stopUpload', text: 'Stop', icon: 'bi bi-stop-fill' },
            ],
            async onClick(event) {
                //console.log('Target: '+ event.target, event);
                //console.log(event.target);
                //document.querySelectorAll(".tab-content").forEach(x=>x.setAttribute("style","display:none"));
                //document.querySelector(`#${event.target}`).setAttribute("style","");
                let content;
                switch (event.target) {
                    case "startUpload": 
                        startOrResumeUpload(upload);
                        break;
                    case "pauseUpload":                        
                    if (upload) {
                        updateButtonState('paused');
                        //uploadFileId="";                       
                        upload.abort();
                        //progressBar.classList.add('progress-bar-warning')
                       // progressBar.classList.remove('bg-success')
                        statusMessage.textContent = "Upload Paused";      
                        }
                        break;
                    case "resumeUpload":                        
                        if (upload) {
                            updateButtonState('uploading');
                            //uploadFileId=(upload.url).substring(((upload.url).lastIndexOf('/'))+1);                            
                            startOrResumeUpload(upload);
                            statusMessage.textContent = "Resuming Upload...";                        
                        }
                        break;
                    case "skipUpload":                        
                        if(upload)
                        {
                            upload.abort();    
                            updateButtonState('paused');
                            statusMessage.textContent = "Upload Paused"; 
                            //progressBar.classList.remove('bg-success');
                            progressBar.classList.add('progress-bar-warning');
                            const queueProgressBar=document.getElementById("queueProgressBar");
                            if(queueProgressBar){
                                queueProgressBar.classList.add('progress-bar-warning');
                            }
                            $('#skipConfirmationModal').modal('show');
                        }    
                        break;    
                    case "stopUpload":                        
                        if(upload)
                        {
                            updateButtonState('paused');                        
                            upload.abort();                        
                            statusMessage.textContent = "Upload Paused"; 
                            //progressBar.classList.remove('bg-success');
                            progressBar.classList.add('progress-bar-warning');
                            const queueProgressBar=document.getElementById("queueProgressBar");
                            if(queueProgressBar){
                                queueProgressBar.classList.add('progress-bar-warning');
                            }
                            $('#stopConfirmationModal').modal('show');
                        }    
                        break;                                    
                    default:
                        break;
                }
            }
                       
        });
       
    </script>
    <script src="javascripts/uploader.js"></script>   
</body>
</html>